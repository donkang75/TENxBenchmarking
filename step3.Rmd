---
title: "rhdf5 tweaks"
author: "Mike Smith"
output: html_document
---

## Installing developmental version of **rhdf5**
 
```{r, installBranch, results = 'hide', message = FALSE, warning = FALSE}

if(packageVersion('rhdf5') != "2.23.1.1") {
    devtools::install_github(repo = "grimbough/rhdf5", ref = "d12b2df", quiet = TRUE, force = TRUE)
}
if(packageVersion('DelayedArray') == "0.5.1.1") {
    BiocInstaller::biocLite("DelayedArray", suppressUpdates = TRUE, ask = FALSE)
}
```

```{r, load-libs, message=FALSE}
library(TENxBrainData)
library(microbenchmark)
options(DelayedArray.block.size=2e9)
```

```{r, load-data, message=FALSE}
tenx <- TENxBrainData()
tenx.sub <- tenx[,1:13000]
```

```{r, save-results}
systime <- system.time(res3 <- colSums(counts(tenx.sub)))
save(res3, file = "res3.rda")
systime
```

```{r, rhdf5-dev}
bm3 <- microbenchmark(colSums(counts(tenx.sub)), 
                      times = 5L, unit = "s",
                      control = list(order = "block", warmup = 0))
bm3 <- rbind(data.frame(expr = "", time = as.numeric(systime[3]) * 1e9), bm3)
bm3$expr <- "rhdf5"
save(bm3, file = "bm3.rda")
bm3
```

```{r, sessionInfo}
sessionInfo()
```